<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TeamPlay Pro</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.1/firebase-database-compat.js"></script>
    
    <style>
        :root { --bg: #0b0e11; --card: #1c2127; --accent: #00d1ff; --text: #ffffff; --subtext: #94a3b8; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body { background: var(--bg); color: var(--text); font-family: -apple-system, system-ui, sans-serif; margin: 0; padding: 10px 15px 120px 15px; overflow-x: hidden; }

        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; }
        .balance-chip { background: rgba(0, 209, 255, 0.1); padding: 8px 15px; border-radius: 20px; color: var(--accent); font-weight: 800; border: 1px solid rgba(0, 209, 255, 0.2); }

        .page { display: none; }
        .page.active { display: block; animation: fadePage 0.3s ease-out; }
        @keyframes fadePage { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        .card { background: var(--card); border-radius: 20px; padding: 20px; margin-bottom: 15px; border: 1px solid rgba(255,255,255,0.05); }
        .btn { background: var(--accent); color: #000; border: none; padding: 16px; border-radius: 16px; font-weight: 800; width: 100%; font-size: 15px; cursor: pointer; }
        .btn-back { background: rgba(255,255,255,0.05); color: #fff; margin-top: 15px; }

        /* CASE & ROULETTE */
        .case-view { background: linear-gradient(135deg, #1e293b, #0f172a); border-radius: 25px; padding: 25px; text-align: center; border: 1px solid var(--accent); margin-bottom: 20px; }
        .roulette-container { height: 100px; background: #000; border-radius: 18px; position: relative; overflow: hidden; margin: 20px 0; display: none; border: 1px solid var(--accent); }
        .line { position: absolute; left: 50%; width: 2px; height: 100%; background: #ff4757; z-index: 10; }
        .tape { display: flex; position: absolute; left: 0; height: 100%; }
        .p-item { min-width: 90px; display: flex; flex-direction: column; justify-content: center; align-items: center; border-right: 1px solid #1a1a1a; }

        /* XP BAR */
        .xp-container { background: #1c2127; height: 8px; border-radius: 4px; margin: 10px 0; overflow: hidden; }
        .xp-bar { background: var(--accent); height: 100%; width: 0%; transition: 0.5s; }

        /* HISTORY LOG */
        .log-entry { font-size: 12px; padding: 10px; border-bottom: 1px solid rgba(255,255,255,0.05); display: flex; justify-content: space-between; }

        .nav { position: fixed; bottom: 0; left: 0; right: 0; background: rgba(11,14,17,0.95); display: flex; justify-content: space-around; padding: 15px 10px 35px 10px; border-top: 1px solid rgba(255,255,255,0.05); }
        .nav-link { color: #4b5563; text-decoration: none; text-align: center; font-size: 10px; }
        .nav-link.active { color: var(--accent); }
        .nav-link i { display: block; font-size: 20px; margin-bottom: 4px; font-style: normal; }
    </style>
</head>
<body>

    <div class="header">
        <div><span id="h-lvl" style="color:var(--accent); font-weight:800; font-size:12px;">LVL 1</span><br><b id="h-name">–ó–∞–≥—Ä—É–∑–∫–∞...</b></div>
        <div class="balance-chip"><span id="h-bal">0</span> ‚≠ê</div>
    </div>

    <div id="p-home" class="page active">
        <div id="game-list">
            <div class="card" onclick="openCase()" style="display:flex; align-items:center; gap:15px;">
                <div style="font-size:30px;">üéÅ</div>
                <div><b>–ö–µ–π—Å –ü—Ä–∏–≤–∏–ª–µ–≥–∏–π</b><br><span style="color:var(--subtext); font-size:12px;">–û—Ç–∫—Ä–æ–π –∏ –ø–æ–ª—É—á–∏ –±–æ–Ω—É—Å—ã!</span></div>
            </div>
            
            <p style="font-size:11px; color:var(--subtext); text-transform:uppercase; margin-top:20px;">–ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ—Ç–∫—Ä—ã—Ç–∏—è</p>
            <div id="global-logs" class="card" style="padding:10px; max-height:200px; overflow-y:auto;">
                <center style="opacity:0.3; padding:10px;">–ò—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞</center>
            </div>
        </div>

        <div id="case-screen" style="display: none;">
            <div class="case-view">
                <div style="font-size:40px;">üéÅ</div>
                <h2 style="margin:10px 0;">–ö–µ–π—Å –ü—Ä–∏–≤–∏–ª–µ–≥–∏–π</h2>
                <div id="r-box" class="roulette-container"><div class="line"></div><div id="tape" class="tape"></div></div>
                <button class="btn" onclick="spin()">–û–¢–ö–†–´–¢–¨ –ó–ê 1000 ‚≠ê</button>
            </div>
            <button class="btn btn-back" onclick="closeCase()">–ù–ê–ó–ê–î</button>
        </div>
    </div>

    <div id="p-profile" class="page">
        <h2 style="margin-bottom:5px;">–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</h2>
        <div class="xp-container"><div id="xp-bar" class="xp-bar"></div></div>
        <div style="text-align:right; font-size:10px; color:var(--subtext); margin-bottom:15px;" id="xp-num">0 / 1000 XP</div>

        <div class="card">
            <b>–ê–∫—Ç–∏–≤–∞—Ü–∏—è –ø—Ä–æ–º–æ–∫–æ–¥–∞</b>
            <input type="text" id="promo-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥..." style="width:100%; background:#000; border:1px solid #333; color:#fff; padding:12px; border-radius:12px; margin:10px 0;">
            <button class="btn" onclick="usePromo()">–ê–ö–¢–ò–í–ò–†–û–í–ê–¢–¨</button>
        </div>

        <div class="card" style="margin-top:10px;">
            <input type="text" id="name-input" placeholder="–ù–∏–∫–Ω–µ–π–º" style="width:100%; background:transparent; border:none; border-bottom:1px solid #333; color:#fff; padding:10px; margin-bottom:10px;">
            <button class="btn" style="background:rgba(255,255,255,0.05); color:#fff;" onclick="saveName()">–ò–ó–ú–ï–ù–ò–¢–¨ –ù–ò–ö</button>
        </div>

        <p style="font-size:11px; color:var(--subtext); text-transform:uppercase; margin:20px 0 10px 5px;">–ú–æ–∏ –Ω–∞–≥—Ä–∞–¥—ã</p>
        <div id="inv-list"></div>
    </div>

    <div id="p-top" class="page"><h2>–¢–æ–ø –∏–≥—Ä–æ–∫–æ–≤ üèÜ</h2><div id="leader-list"></div></div>
    <div id="p-bonus" class="page"><h2>–ë–æ–Ω—É—Å—ã ‚ö°</h2><div class="card" onclick="claimDaily()"><b>–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–æ–Ω—É—Å</b><br><span id="d-timer">–ù–∞–∂–º–∏, —á—Ç–æ–±—ã –∑–∞–±—Ä–∞—Ç—å!</span></div></div>

    <nav class="nav">
        <a href="#" class="nav-link active" onclick="showP('home', this)"><i>üè†</i>–ì–ª–∞–≤–Ω–∞—è</a>
        <a href="#" class="nav-link" onclick="showP('top', this)"><i>üèÜ</i>–¢–û–ü</a>
        <a href="#" class="nav-link" onclick="showP('bonus', this)"><i>‚ö°</i>–ë–æ–Ω—É—Å—ã</a>
        <a href="#" class="nav-link" onclick="showP('profile', this)"><i>üë§</i>–ü—Ä–æ—Ñ–∏–ª—å</a>
    </nav>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBPx6V-_sE6k1_hnOkCvR8E1wOlsabVMbc",
            authDomain: "teamplay-9f75a.firebaseapp.com",
            databaseURL: "https://teamplay-9f75a-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "teamplay-9f75a",
            storageBucket: "teamplay-9f75a.firebasestorage.app",
            messagingSenderId: "975773372092",
            appId: "1:975773372092:web:0a67ef446f6c8444318ab9"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const tg = window.Telegram.WebApp;
        const uid = tg.initDataUnsafe?.user?.id || "dev_user";
        const uRef = db.ref('users/' + uid);

        const prizes = [
            { n: "1—á STANDART", i: "ü•â", p: 15 }, { n: "1—á VIP", i: "ü•à", p: 10 },
            { n: "–ü–° 4 - 1—á", i: "üéÆ", p: 15 }, { n: "500 ‚≠ê", i: "‚≠ê", p: 60, coin: 500 }
        ];

        // –ò–°–¢–û–†–ò–Ø –û–¢–ö–†–´–¢–ò–ô
        db.ref('logs').limitToLast(10).on('value', s => {
            let html = '';
            s.forEach(l => {
                const val = l.val();
                html = `<div class="log-entry"><span>${val.name}</span> <b style="color:var(--accent)">${val.prize}</b></div>` + html;
            });
            document.getElementById('global-logs').innerHTML = html || '<center>–ò—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞</center>';
        });

        uRef.on('value', snap => {
            const d = snap.val() || { balance: 0, lvl: 1, xp: 0 };
            document.getElementById('h-bal').innerText = d.balance;
            document.getElementById('h-name').innerText = d.name || "–ò–≥—Ä–æ–∫";
            document.getElementById('h-lvl').innerText = `LVL ${d.lvl}`;
            document.getElementById('xp-bar').style.width = ((d.xp || 0) / ((d.lvl || 1) * 1000) * 100) + "%";
            document.getElementById('xp-num').innerText = `${d.xp || 0} / ${(d.lvl || 1) * 1000} XP`;
            
            const inv = d.inventory ? Object.values(d.inventory).reverse() : [];
            document.getElementById('inv-list').innerHTML = inv.map(i => `
                <div class="card" style="padding:15px; margin-bottom:8px; display:flex; justify-content:space-between;">
                    <b>${i.title}</b> <span>${i.icon}</span>
                </div>
            `).join('');
        });

        function spin() {
            uRef.once('value', s => {
                const d = s.val();
                if(d.balance < 1000) return tg.showAlert("–ù—É–∂–Ω–æ 1000 ‚≠ê");
                
                document.getElementById('r-box').style.display = 'block';
                const win = prizes[Math.floor(Math.random()*prizes.length)];
                
                // –ó–∞–ø–∏—Å—å –≤ –∏—Å—Ç–æ—Ä–∏—é
                db.ref('logs').push({ name: d.name || "–ò–≥—Ä–æ–∫", prize: win.n });

                setTimeout(() => {
                    uRef.update({ balance: d.balance - 1000 + (win.coin || 0), xp: (d.xp || 0) + 200 });
                    if(!win.coin) uRef.child('inventory').push({ title: win.n, icon: win.i, date: "–°–µ–≥–æ–¥–Ω—è" });
                    tg.showAlert("–í—ã–ø–∞–ª–æ: " + win.n);
                    document.getElementById('r-box').style.display = 'none';
                }, 2000);
            });
        }

        function usePromo() {
            const code = document.getElementById('promo-input').value.toUpperCase();
            if(code === 'TEAMPLAY') {
                uRef.update({ balance: 5000 });
                tg.showAlert("–ü—Ä–æ–º–æ–∫–æ–¥ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω! +5000 ‚≠ê");
            } else {
                tg.showAlert("–ù–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥");
            }
        }

        function showP(id, el) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-link').forEach(n => n.classList.remove('active'));
            document.getElementById('p-' + id).classList.add('active');
            el.classList.add('active');
        }
        function openCase() { document.getElementById('game-list').style.display='none'; document.getElementById('case-screen').style.display='block'; }
        function closeCase() { document.getElementById('game-list').style.display='block'; document.getElementById('case-screen').style.display='none'; }
        function saveName() { uRef.update({ name: document.getElementById('name-input').value }); }
    </script>
</body>
</html>
