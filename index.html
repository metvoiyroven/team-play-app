<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TeamPlay Pro</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.1/firebase-database-compat.js"></script>
    
    <style>
        :root { --bg: #0b0e11; --card: #1c2127; --accent: #00d1ff; --text: #ffffff; --subtext: #94a3b8; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg); color: var(--text); font-family: -apple-system, system-ui, sans-serif; margin: 0; padding: 10px 15px 120px 15px; }

        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; }
        .balance-chip { background: rgba(0, 209, 255, 0.1); padding: 8px 15px; border-radius: 20px; color: var(--accent); font-weight: 800; border: 1px solid rgba(0, 209, 255, 0.2); }

        .page { display: none; }
        .page.active { display: block; animation: fadePage 0.3s ease-out; }
        @keyframes fadePage { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* –°–ü–ò–°–û–ö –ò–ì–† */
        .game-card { 
            background: var(--card); border-radius: 22px; padding: 20px; 
            margin-bottom: 15px; border: 1px solid rgba(255,255,255,0.05); 
            display: flex; align-items: center; gap: 15px; cursor: pointer; transition: 0.2s;
        }
        .game-card:active { transform: scale(0.96); }

        /* –≠–ö–†–ê–ù –ö–ï–ô–°–ê */
        .case-view { 
            background: linear-gradient(135deg, #1e293b, #0f172a); border-radius: 22px; 
            padding: 25px; text-align: center; border: 1px solid var(--accent); margin-bottom: 20px;
            animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes popIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }

        /* –ü–†–ò–ó–´ */
        .prize-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 20px; }
        .prize-item { 
            background: var(--card); padding: 10px; border-radius: 15px; 
            text-align: center; border: 1px solid rgba(255,255,255,0.03); 
            opacity: 0; animation: slideUp 0.5s ease forwards;
        }
        @keyframes slideUp { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }

        .btn { background: var(--accent); color: #000; border: none; padding: 16px; border-radius: 16px; font-weight: 800; width: 100%; font-size: 15px; cursor: pointer; }
        .btn-back { background: rgba(255,255,255,0.05); color: #fff; margin-top: 15px; border: 1px solid rgba(255,255,255,0.1); }

        /* –†–£–õ–ï–¢–ö–ê */
        .roulette-container { height: 110px; background: #000; border-radius: 18px; position: relative; overflow: hidden; margin: 20px 0; display: none; border: 1px solid var(--accent); }
        .line { position: absolute; left: 50%; top: 0; bottom: 0; width: 3px; background: #ff4757; z-index: 10; }
        .tape { display: flex; position: absolute; left: 0; height: 100%; transition: transform 4s cubic-bezier(0.1, 0, 0.1, 1); }
        .p-item { min-width: 100px; display: flex; flex-direction: column; justify-content: center; align-items: center; border-right: 1px solid #1a1a1a; }

        .nav { position: fixed; bottom: 0; left: 0; right: 0; background: rgba(11,14,17,0.95); display: flex; justify-content: space-around; padding: 15px 10px 35px 10px; backdrop-filter: blur(20px); border-top: 1px solid rgba(255,255,255,0.05); }
        .nav-link { color: #4b5563; text-decoration: none; text-align: center; font-size: 10px; font-weight: 600; }
        .nav-link.active { color: var(--accent); }
        .nav-link i { display: block; font-size: 22px; margin-bottom: 5px; font-style: normal; }
    </style>
</head>
<body>

    <div class="header">
        <div><span id="h-lvl" style="color:var(--accent); font-weight:800; font-size:12px;">LVL 1</span><br><b id="h-name" style="font-size:18px;">–ò–≥—Ä–æ–∫</b></div>
        <div class="balance-chip"><span id="h-bal">0</span> ‚≠ê</div>
    </div>

    <div id="p-home" class="page active">
        <div id="game-list">
            <div class="game-card" onclick="openCase()">
                <div style="font-size: 32px;">üéÅ</div>
                <div><b>–ö–µ–π—Å –ü—Ä–∏–≤–∏–ª–µ–≥–∏–π</b><br><span style="color:var(--subtext); font-size:12px;">–û—Ç–∫—Ä–æ–π –∏ –ø–æ–ª—É—á–∏ –±–æ–Ω—É—Å—ã –¥–ª—è –∫–ª—É–±–∞!</span></div>
            </div>
        </div>

        <div id="case-screen" style="display: none;">
            <div class="case-view">
                <div style="font-size: 50px;">üéÅ</div>
                <h2>–ö–µ–π—Å –ü—Ä–∏–≤–∏–ª–µ–≥–∏–π</h2>
                <div id="r-box" class="roulette-container"><div class="line"></div><div id="tape" class="tape"></div></div>
                <button class="btn" onclick="spin()">–û–¢–ö–†–´–¢–¨ –ó–ê 1000 ‚≠ê</button>
            </div>
            <p style="font-size:11px; color:var(--subtext); text-transform:uppercase; margin-bottom:15px;">–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏–∑—ã</p>
            <div id="prize-grid" class="prize-grid"></div>
            <button class="btn btn-back" onclick="closeCase()">–ù–ê–ó–ê–î</button>
        </div>
    </div>

    <div id="p-top" class="page"><h2>–¢–æ–ø –∏–≥—Ä–æ–∫–æ–≤ üèÜ</h2><div id="leader-list"></div></div>
    <div id="p-bonus" class="page"><h2>–ë–æ–Ω—É—Å—ã ‚ö°</h2></div>
    <div id="p-profile" class="page"><h2>–ü—Ä–æ—Ñ–∏–ª—å üë§</h2><div id="inv-list"></div></div>

    <nav class="nav">
        <a href="#" class="nav-link active" onclick="showP('home', this)"><i>üè†</i>–ì–ª–∞–≤–Ω–∞—è</a>
        <a href="#" class="nav-link" onclick="showP('top', this)"><i>üèÜ</i>–¢–û–ü</a>
        <a href="#" class="nav-link" onclick="showP('bonus', this)"><i>‚ö°</i>–ë–æ–Ω—É—Å—ã</a>
        <a href="#" class="nav-link" onclick="showP('profile', this)"><i>üë§</i>–ü—Ä–æ—Ñ–∏–ª—å</a>
    </nav>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBPx6V-_sE6k1_hnOkCvR8E1wOlsabVMbc",
            authDomain: "teamplay-9f75a.firebaseapp.com",
            databaseURL: "https://teamplay-9f75a-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "teamplay-9f75a",
            storageBucket: "teamplay-9f75a.firebasestorage.app",
            messagingSenderId: "975773372092",
            appId: "1:975773372092:web:0a67ef446f6c8444318ab9"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const tg = window.Telegram.WebApp;
        tg.expand();

        const uid = tg.initDataUnsafe?.user?.id || "dev_user";
        const uRef = db.ref('users/' + uid);

        // –í–°–ï –ü–†–ò–ó–´ –ò–ó –í–ê–®–ï–ì–û –°–ü–ò–°–ö–ê
        const prizes = [
            { n: "1—á STANDART", i: "ü•â", p: 10 },
            { n: "1—á VIP", i: "ü•à", p: 6 },
            { n: "3—á STANDART", i: "ü•â", p: 4 },
            { n: "3—á VIP", i: "ü•à", p: 3 },
            { n: "6—á STANDART", i: "ü•â", p: 2 },
            { n: "6—á VIP", i: "ü•à", p: 1 },
            { n: "–ü–° 4 - 1—á", i: "üéÆ", p: 20 },
            { n: "–ü–° 5 - 1—á", i: "üöÄ", p: 10 },
            { n: "500 ‚≠ê", i: "‚≠ê", p: 44, coin: 500 }
        ];

        function openCase() {
            document.getElementById('game-list').style.display = 'none';
            document.getElementById('case-screen').style.display = 'block';
            tg.HapticFeedback.impactOccurred('medium');
            
            const grid = document.getElementById('prize-grid');
            grid.innerHTML = prizes.map((p, i) => `
                <div class="prize-item" style="animation-delay: ${i*0.05}s">
                    <div style="font-size:24px">${p.i}</div>
                    <b style="font-size:9px">${p.n}</b>
                </div>
            `).join('');
        }

        function closeCase() {
            document.getElementById('game-list').style.display = 'block';
            document.getElementById('case-screen').style.display = 'none';
        }

        function getPrize() {
            let r = Math.random() * 100;
            let s = 0;
            for(let p of prizes) {
                s += p.p;
                if(r <= s) return p;
            }
            return prizes[prizes.length-1];
        }

        function spin() {
            uRef.once('value', snap => {
                const d = snap.val() || { balance: 0 };
                if(d.balance < 1000) return tg.showAlert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–≤–µ–∑–¥!");

                const box = document.getElementById('r-box');
                const tape = document.getElementById('tape');
                box.style.display = 'block';
                tape.style.transition = 'none';
                tape.style.transform = 'translateX(0)';

                let h = '';
                for(let i=0; i<60; i++) {
                    const r = prizes[Math.floor(Math.random()*prizes.length)];
                    h += `<div class="p-item"><div>${r.i}</div><b style="font-size:9px">${r.n}</b></div>`;
                }
                tape.innerHTML = h;

                const winIdx = 50;
                const win = getPrize();
                tape.children[winIdx].innerHTML = `<div style="color:var(--accent)">${win.i}</div><b style="font-size:9px">${win.n}</b>`;

                setTimeout(() => {
                    tape.style.transition = 'transform 4s cubic-bezier(0.1, 0, 0.1, 1)';
                    tape.style.transform = `translateX(-${(winIdx * 100) - (box.offsetWidth/2) + 50}px)`;
                }, 50);

                setTimeout(() => {
                    tg.HapticFeedback.notificationOccurred('success');
                    uRef.update({ balance: d.balance - 1000 + (win.coin || 0) });
                    if(!win.coin) uRef.child('inventory').push({ title: win.n, icon: win.i, date: new Date().toLocaleDateString() });
                    tg.showAlert("–¢–≤–æ–π –ø—Ä–∏–∑: " + win.n);
                    box.style.display = 'none';
                }, 4300);
            });
        }

        uRef.on('value', snap => {
            const d = snap.val() || { balance: 0, lvl: 1, name: "–ò–≥—Ä–æ–∫" };
            document.getElementById('h-bal').innerText = d.balance;
            document.getElementById('h-name').innerText = d.name;
            document.getElementById('h-lvl').innerText = `LVL ${d.lvl}`;
        });

        function showP(id, el) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-link').forEach(n => n.classList.remove('active'));
            document.getElementById('p-' + id).classList.add('active');
            el.classList.add('active');
            if(id === 'home') closeCase();
        }
    </script>
</body>
</html>
