<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TeamPlay - PC Club</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.1/firebase-database-compat.js"></script>
    
    <style>
        :root { 
            --bg: #0b0e11; 
            --card: #1c2127; 
            --accent: #00d1ff; 
            --text: #ffffff; 
            --subtext: #94a3b8;
            --nav-bg: rgba(11, 14, 17, 0.98); 
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body { 
            background: var(--bg); 
            color: var(--text); 
            font-family: -apple-system, system-ui, sans-serif; 
            margin: 0; 
            padding: 15px 15px 100px 15px; 
            line-height: 1.4;
        }

        /* HEADER */
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; padding: 0 5px; }
        .user-info { display: flex; flex-direction: column; }
        .user-info b { font-size: 18px; }
        .balance-pill { 
            background: rgba(0, 209, 255, 0.1); 
            padding: 8px 16px; 
            border-radius: 20px; 
            color: var(--accent); 
            font-weight: 800; 
            border: 1px solid rgba(0, 209, 255, 0.2);
            display: flex; align-items: center; gap: 5px;
        }

        /* –ì–õ–ê–í–ù–´–ô –≠–ö–†–ê–ù */
        .main-card {
            background: linear-gradient(135deg, #1e293b, #0f172a);
            border-radius: 24px;
            padding: 25px;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.05);
            box-shadow: 0 10px 25px -5px rgba(0,0,0,0.3);
            margin-bottom: 20px;
        }

        /* –ú–û–î–ê–õ–¨–ù–´–ï –û–ö–ù–ê */
        .page { display: none; flex-direction: column; }
        .page.active { display: flex; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* –ü–†–û–ì–†–ï–°–° –ë–ê–† */
        .lvl-badge { color: var(--accent); font-weight: bold; font-size: 14px; }
        .xp-wrapper { background: rgba(255,255,255,0.05); height: 8px; border-radius: 4px; margin: 12px 0; overflow: hidden; }
        .xp-progress { height: 100%; background: var(--accent); width: 0%; transition: width 0.5s ease; box-shadow: 0 0 10px var(--accent); }

        /* –°–ü–ò–°–û–ö –ó–ê–î–ê–ù–ò–ô –ò –ò–ù–í–ï–ù–¢–ê–†–¨ */
        .list-item {
            background: var(--card);
            border-radius: 18px;
            padding: 16px;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid rgba(255,255,255,0.03);
        }
        .item-info { display: flex; flex-direction: column; gap: 4px; }
        .item-info b { font-size: 15px; }
        .item-info small { color: var(--subtext); font-size: 12px; }

        /* –ö–ù–û–ü–ö–ò */
        .btn {
            background: var(--accent);
            color: #000;
            border: none;
            padding: 12px 20px;
            border-radius: 14px;
            font-weight: 700;
            cursor: pointer;
            font-size: 14px;
            transition: 0.2s;
        }
        .btn:active { transform: scale(0.96); }
        .btn:disabled { background: #2d3748; color: #718096; }
        .btn-full { width: 100%; padding: 16px; font-size: 16px; margin-top: 10px; }
        .btn-outline { background: transparent; border: 1px solid rgba(255,255,255,0.1); color: var(--text); }

        /* –ò–ù–ü–£–¢–´ */
        input {
            width: 100%;
            background: #0f172a;
            border: 1px solid rgba(255,255,255,0.1);
            padding: 16px;
            border-radius: 14px;
            color: #fff;
            font-size: 16px;
            margin-bottom: 12px;
            outline: none;
        }
        input:focus { border-color: var(--accent); }

        /* –†–£–õ–ï–¢–ö–ê */
        .roulette-box {
            height: 120px;
            background: #000;
            border-radius: 18px;
            position: relative;
            overflow: hidden;
            margin: 20px 0;
            display: none;
            border: 1px solid var(--accent);
        }
        .pointer { position: absolute; left: 50%; top: 0; bottom: 0; width: 2px; background: red; z-index: 5; }
        .tape { display: flex; position: absolute; left: 0; height: 100%; transition: transform 4s cubic-bezier(0.1, 0, 0.1, 1); }
        .p-box { min-width: 100px; display: flex; flex-direction: column; justify-content: center; align-items: center; border-right: 1px solid #1a1a1a; font-size: 11px; }

        /* –ù–ê–í–ò–ì–ê–¶–ò–Ø */
        .nav {
            position: fixed;
            bottom: 0; left: 0; right: 0;
            background: var(--nav-bg);
            display: flex;
            justify-content: space-around;
            padding: 10px 10px 25px 10px;
            backdrop-filter: blur(20px);
            border-top: 1px solid rgba(255,255,255,0.05);
        }
        .nav-link { color: #4a5568; text-decoration: none; text-align: center; font-size: 11px; font-weight: 500; }
        .nav-link.active { color: var(--accent); }
        .nav-link i { display: block; font-size: 22px; margin-bottom: 4px; font-style: normal; }

        h2 { margin: 0 0 15px 0; font-size: 22px; }
        .section-label { color: var(--subtext); font-size: 12px; text-transform: uppercase; letter-spacing: 1px; margin: 25px 0 15px 5px; }
    </style>
</head>
<body>

    <div class="header">
        <div class="user-info">
            <span id="header-lvl" class="lvl-badge">LVL 1</span>
            <b id="header-name">–ó–∞–≥—Ä—É–∑–∫–∞...</b>
        </div>
        <div class="balance-pill">
            <span id="top-balance">0</span> ‚≠ê
        </div>
    </div>

    <div id="page-home" class="page active">
        <div class="main-card">
            <div style="font-size: 50px; margin-bottom: 10px;">üéÅ</div>
            <h2>–ö–µ–π—Å –ü—Ä–∏–≤–∏–ª–µ–≥–∏–π</h2>
            <p style="color: var(--subtext); margin-bottom: 20px;">–û—Ç–∫—Ä–æ–π –∏ –ø–æ–ª—É—á–∏ –±–æ–Ω—É—Å—ã –¥–ª—è –∫–ª—É–±–∞!</p>
            
            <div id="roulette-ui" class="roulette-box">
                <div class="pointer"></div>
                <div id="tape-el" class="tape"></div>
            </div>

            <button class="btn btn-full" onclick="spinCase()">–û–¢–ö–†–´–¢–¨ –ó–ê 1000 ‚≠ê</button>
        </div>
        
        <div class="section-label">–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏–∑—ã</div>
        <div id="prizes-grid" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px;"></div>
    </div>

    <div id="page-bonuses" class="page">
        <h2>–ë–æ–Ω—É—Å—ã ‚ö°</h2>
        
        <div class="list-item">
            <div class="item-info">
                <b>–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–æ–Ω—É—Å</b>
                <small id="daily-text">–î–æ—Å—Ç—É–ø–Ω–æ +50 ‚≠ê</small>
            </div>
            <button id="btn-daily" class="btn" onclick="claimDaily()">–í–ó–Ø–¢–¨</button>
        </div>

        <div class="section-label">–ó–∞–¥–∞–Ω–∏—è</div>
        
        <div class="list-item">
            <div class="item-info"><b>–ü–æ–¥–ø–∏—Å–∫–∞ –í–ö</b><small>+300 ‚≠ê</small></div>
            <button id="task-vk" class="btn" onclick="doTask('vk', 'https://vk.com', 300)">300 ‚≠ê</button>
        </div>
        <div class="list-item">
            <div class="item-info"><b>Telegram –∫–∞–Ω–∞–ª</b><small>+500 ‚≠ê</small></div>
            <button id="task-tg" class="btn" onclick="doTask('tg', 'https://t.me', 500)">500 ‚≠ê</button>
        </div>
        <div class="list-item">
            <div class="item-info"><b>–ü–æ—Å—Ç –Ω–∞ —Å—Ç–µ–Ω—É –í–ö</b><small>+1000 ‚≠ê</small></div>
            <button id="task-post" class="btn" onclick="doTask('post', 'https://vk.com', 1000)">1000 ‚≠ê</button>
        </div>
    </div>

    <div id="page-profile" class="page">
        <h2>–ü—Ä–æ—Ñ–∏–ª—å üë§</h2>
        
        <div class="main-card" style="text-align: left; padding: 20px;">
            <div style="display: flex; justify-content: space-between;">
                <b>–í–∞—à –ø—Ä–æ–≥—Ä–µ—Å—Å</b>
                <span id="profile-xp-val" class="lvl-badge">0 / 1000 XP</span>
            </div>
            <div class="xp-wrapper"><div id="xp-fill" class="xp-progress"></div></div>
            <small style="color: var(--subtext)">–£—Ä–æ–≤–µ–Ω—å –ø–æ–≤—ã—à–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 10 –æ—Ç–∫—Ä—ã—Ç–∏–π</small>
        </div>

        <input type="text" id="name-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è...">
        <button class="btn btn-full" onclick="updateName()">–°–û–•–†–ê–ù–ò–¢–¨ –ò–ú–Ø</button>

        <div class="section-label">–ú–æ–∏ –Ω–∞–≥—Ä–∞–¥—ã üéí</div>
        <div id="inventory"></div>
    </div>

    <nav class="nav">
        <a href="#" class="nav-link active" onclick="showPage('home', this)"><i>üè†</i>–ì–ª–∞–≤–Ω–∞—è</a>
        <a href="#" class="nav-link" onclick="showPage('bonuses', this)"><i>‚ö°</i>–ë–æ–Ω—É—Å—ã</a>
        <a href="#" class="nav-link" onclick="showPage('profile', this)"><i>üë§</i>–ü—Ä–æ—Ñ–∏–ª—å</a>
    </nav>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBPx6V-_sE6k1_hnOkCvR8E1wOlsabVMbc",
            authDomain: "teamplay-9f75a.firebaseapp.com",
            databaseURL: "https://teamplay-9f75a-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "teamplay-9f75a",
            storageBucket: "teamplay-9f75a.firebasestorage.app",
            messagingSenderId: "975773372092",
            appId: "1:975773372092:web:0a67ef446f6c8444318ab9"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const tg = window.Telegram.WebApp;
        tg.expand();

        const uid = tg.initDataUnsafe?.user?.id || "dev_user";
        const uRef = db.ref('users/' + uid);

        const items = [
            { n: "1—á STANDART", i: "ü•â", w: 10 }, { n: "1—á VIP", i: "ü•à", w: 6 },
            { n: "3—á VIP", i: "ü•à", w: 3 }, { n: "–ü–° 4 - 1—á", i: "üéÆ", w: 20 },
            { n: "500 ‚≠ê", i: "‚≠ê", w: 50, coin: 500 }
        ];

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–∑–æ–≤
        document.getElementById('prizes-grid').innerHTML = items.map(x => `
            <div style="background:var(--card); padding:12px; border-radius:12px; text-align:center; font-size:10px; border:1px solid rgba(255,255,255,0.03)">
                <div style="font-size:20px">${x.i}</div><b>${x.n}</b>
            </div>
        `).join('');

        uRef.on('value', snap => {
            const d = snap.val() || {};
            document.getElementById('top-balance').innerText = d.balance || 0;
            document.getElementById('header-name').innerText = d.name || "–ò–≥—Ä–æ–∫";
            document.getElementById('header-lvl').innerText = `LVL ${d.lvl || 1}`;
            
            // –ü—Ä–æ–≥—Ä–µ—Å—Å
            const xp = d.xp || 0;
            const target = (d.lvl || 1) * 1000;
            document.getElementById('profile-xp-val').innerText = `${xp} / ${target} XP`;
            document.getElementById('xp-fill').style.width = (xp/target*100) + '%';

            // –ó–∞–¥–∞–Ω–∏—è
            if(d.tasks?.vk) { document.getElementById('task-vk').disabled = true; document.getElementById('task-vk').innerText = "‚úÖ"; }
            if(d.tasks?.tg) { document.getElementById('task-tg').disabled = true; document.getElementById('task-tg').innerText = "‚úÖ"; }
            if(d.tasks?.post) { document.getElementById('task-post').disabled = true; document.getElementById('task-post').innerText = "‚úÖ"; }

            // –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å
            const inv = d.inventory ? Object.values(d.inventory).reverse() : [];
            document.getElementById('inventory').innerHTML = inv.map(i => `
                <div class="list-item">
                    <div class="item-info"><b>${i.title}</b><small>${i.date}</small></div>
                    <div style="font-size:18px">üéÅ</div>
                </div>
            `).join(inv.length ? '' : '<center style="opacity:0.3">–ü—É—Å—Ç–æ</center>');

            checkDaily(d.last_d);
        });

        function showPage(id, el) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-link').forEach(n => n.classList.remove('active'));
            document.getElementById('page-' + id).classList.add('active');
            el.classList.add('active');
        }

        function updateName() {
            const val = document.getElementById('name-input').value;
            if(val) uRef.update({ name: val }).then(() => tg.showAlert("–ò–º—è –æ–±–Ω–æ–≤–ª–µ–Ω–æ!"));
        }

        function claimDaily() {
            uRef.get().then(s => {
                const d = s.val() || {};
                const now = Date.now();
                if(d.last_d && now - d.last_d < 86400000) return;
                uRef.update({ balance: (d.balance || 0) + 50, last_d: now });
                tg.showAlert("–í—ã –ø–æ–ª—É—á–∏–ª–∏ 50 ‚≠ê!");
            });
        }

        function checkDaily(last) {
            const btn = document.getElementById('btn-daily');
            const txt = document.getElementById('daily-text');
            if(!last) return;
            const left = 86400000 - (Date.now() - last);
            if(left > 0) {
                btn.disabled = true;
                txt.innerText = "–ë—É–¥–µ—Ç —á–µ—Ä–µ–∑ " + Math.floor(left/3600000) + "—á.";
            } else {
                btn.disabled = false;
                txt.innerText = "–î–æ—Å—Ç—É–ø–Ω–æ +50 ‚≠ê";
            }
        }

        function doTask(id, url, rev) {
            tg.openLink(url);
            setTimeout(() => {
                uRef.get().then(s => {
                    const d = s.val() || {};
                    if(d.tasks?.[id]) return;
                    uRef.update({ balance: (d.balance || 0) + rev, [`tasks/${id}`]: true });
                });
            }, 3000);
        }

        function spinCase() {
            uRef.get().then(s => {
                const d = s.val() || {};
                if((d.balance || 0) < 1000) return tg.showAlert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–≤
